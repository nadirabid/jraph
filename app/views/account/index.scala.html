@(hypergraphs: play.api.libs.json.JsValue)

@import play.api.libs.json.Json

<!DOCTYPE html>
<html>
  <head lang="en">
    <meta charset="UTF-8">
    <title>Graphs</title>
    <link rel="stylesheet" href="@routes.Assets.at("style/dependencies/bootstrap.css")">
    <style>
      html, body {
        height: 100%;
      }

      #graphsList {
        margin-bottom: 0;
      }

      .graphs-container {
        background-color: #eee;
        width: 700px;
        margin: 0 auto;
        padding: 0;
      }

      .graph-min-view {
        background-color:#34495E;
      }
    </style>
    <script>

    </script>
  </head>
  <body>
    <div class="graphs-container">
      <dl id="graphsList" class="dl-horizontal">
        <dt>Persons</dt>
        <dd>
          <svg class="graph-min-view" width="500" height="300">

          </svg>
        </dd>
        <dt>Tasks</dt>
        <dd>
          <svg class="graph-min-view" width="500" height="300">

          </svg>
        </dd>
        <dt>East of Eden</dt>
        <dd>
          <svg class="graph-min-view" width="500" height="300">

          </svg>
        </dd>
      </dl>
    </div>
  </body>
  <script src="@routes.Assets.at("js/dependencies/require.js")"></script>

  <script>
    require.config({
      baseUrl: '/assets/js',
      paths: {
        d3: 'dependencies/d3',
        jquery: 'dependencies/jquery-2.1.1',
        lodash: 'dependencies/lodash',
        mousetrap: 'dependencies/mousetrap',
        q: 'dependencies/q',
        snap: 'dependencies/snap.svg',
        vue: 'dependencies/vue',
        bootstrap: 'dependencies/bootstrap',
        page: 'dependencies/page'
      }
    });

    require([
        'lodash',
        'jquery',
        'vue',
        'models'
    ], function(_, $, Vue, models){
      var Node = models.Node;
      var Link = models.Link;

      var hypergraphs = @Html(Json.stringify(hypergraphs)); //bootstrap json data into view template

      var hypergraphsData = _.map(hypergraphs, function(hg) {
        return $
            .when(Node.fetchAll(hg.id), Node.fetchAll(hg.id))
            .then(function(nodes, links) {
              nodes.forEach(function (n) {
                links.forEach(function (l) {
                  if (l.sourceId == n.id) l.source = n;
                  if (l.targetId == n.id) l.target = n;
                });
              });
            });
      });

    });
  </script>
</html>