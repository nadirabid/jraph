@layout("Data Visualization") {
  <div id="all">
    <nav  id="nav" class="navbar navbar-default">
    @views.html.graph.navbar()
    </nav>
    <main id="main">
      <div class="graph-container">
        <svg id="graph" v-on="contextmenu:contextMenu, wheel:mousewheelZoom">
            <!-- Definitions -->
          <defs>
            <marker
            id="linkArrow"
            markerWidth="5"
            markerHeight="3"
            refx="1.2"
            refy="1.5"
            orient="auto"
            >
              <path d="M0,0 L0,3 L3,1.5 L0,0" class="link-arrow"></path>
            </marker>
          </defs>

          <g v-el="nodesAndLinksGroup">
              <!-- Dynamic Content -->
            <g class="dynamic-content" v-el="dynamicContent"></g>

              <!-- Links -->
            <x-link v-repeat="links" track-by="id"></x-link>

              <!-- Nodes -->
            <x-node v-repeat="nodes" track-by="id"></x-node>
          </g>
        </svg>

        <ul id="nodeContextMenu" class="dropdown-menu hidden" role="menu" style="position:absolute;">
          <li role="presentation" v-on="click:delete"><a role="menuitem" tabindex="-1">Delete Node</a></li>
          <li role="presentation" v-on="click:link"><a role="menuitem" tabindex="-1">Link Node</a></li>
        </ul>

        <ul id="linkContextMenu" class="dropdown-menu hidden" role="menu" style="position:absolute;">
          <li role="presentation" v-on="click:delete"><a role="menuitem" tabindex="-1">Delete Link</a></li>
        </ul>

        <ul id="graphContextMenu" class="dropdown-menu hidden" role="menu" style="position:absolute;">
          <li role="presentation" v-on="click:addNode"><a role="menuitem" tabindex="-1">Add Node</a></li>
          <li role="presentation" v-on="click:saveGraph"><a role="menuitem" tabindex="-1">Save Graph</a></li>
        </ul>
      </div>

      <div class="x-paper floating-panel-bar hide" id="floatingPanelBar" v-cloak></div>

      <div id="zoomBar" style="position:absolute;" v-cloak>
        <div class="btn-group-vertical zoom-bar" role="group">
          <button type=button class="btn btn-default" v-on="click:incrementZoomLevel">
            <span class="glyphicon glyphicon-plus"></span>
          </button>
          <button type=button class="btn btn-default" v-on="click:decrementZoomLevel">
            <span class="glyphicon glyphicon-minus"></span>
          </button>
        </div>
      </div>
    </main>
  </div>
}

<template id="graph.node.rect">
  <g
    class="node enable-pointer-events"
    v-attr="id: id, transform: nodeTranslate"
  >
    <rect
        class="node-rect-background"
        rx="2"
        ry="2"
        v-el="nodeRectBackground"
        v-attr="width:width, height:height, transform:rectTranslate"
        v-class="active:fixed"
    ></rect>
    <rect
        class="node-rect"
        rx="2"
        ry="2"
        v-el="nodeRect"
        v-attr="width:width, height:height, transform:rectTranslate"
        v-on="contextmenu:nodeContextMenu"
    ></rect>
    <text
        class="node-name disable-pointer-events"
        text-anchor="middle"
        v-el="nodeName"
    >
      {{data.name}}
    </text>
  </g>
</template>

<template id="graph.link">
  <g class="enable-pointer-events" v-on="contextmenu:linkContextMenu">
    <line
        class="link"
        marker-end="url(#linkArrow)"
        v-el="arrowMarkerLine"
        v-attr="x1:sourceClipX, y1:sourceClipY, x2:targetClipX, y2:targetClipY"
    ></line>
  </g>
</template>

<template id="graph.ghostLink">
  <line
      class="ghost-link link"
      marker-end="url(#linkArrow)"
      v-attr="x1:source.x, y1:source.y, x2:target.x, y2:target.y"
  >
  </line>
</template>

<template id="node.panel">
  <div class="node-panel">
    <button type="button" class="close" aria-label="Close" v-on="click:closeNodePanel">
      <span aria-hidden="true">&times;</span>
    </button>
    <h3 v-on="click:editName" v-class="hidden:editingName">{{node.data.name}}</h3>
    <input
        type="text"
        class="form-control input-lg"
        v-model="node.data.name"
        v-class="hidden:!editingName"
        v-el="nameInput"
        v-on="
            blur   : updateName,
            keyup  : updateName       | key enter,
            keyup  : cancelNameUpdate | key esc
        "
    >
    <ul class="list-unstyled">
      <li v-repeat="propsGroup: propertyGroups">
        <dl class="node-property-list">
          <dt>{{$key}}</dt>
          <dd v-repeat="prop: propsGroup">
            <div
                v-class="hidden:prop.edit_"
            >
                {{prop.value}}
              <button
                  aria-label="Close"
                  class="close"
                  type="button"
                  v-on="click: removeProp(this)"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <input
                type="text"
                class="form-control"
                v-class="hidden:!prop.edit_"
                v-on="
                    blur   : updateProp(this),
                    keyup  : updateProp(this)        | key enter,
                    keyup  : cancelPropUpdate(this)  | key esc
                "
            >
          </dd>
        </dl>
      </li>
      <li class="input-group" v-el="propertyInputGroup">
        <input
            class="form-control"
            placeholder="Value"
            type="text"
            v-el="propertyValue"
            v-on="keydown:validateInputChange, paste:validateInputChange"
        >
        <div class="input-group-btn" role="group">
          <button
              type="button"
              class="btn btn-default dropdown-toggle disabled"
              data-toggle="dropdown"
              v-el="addDropdownBtn"
          >
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
          </button>
          <ul class="dropdown-menu dropdown-menu-right" role="menu">
            <li role="presentation" class="dropdown-header">Add as</li>
            <li><a role="menuitem" v-on="click:addProp('text')">Text</a></li>
            <li><a role="menuitem" v-on="click:addProp('phone')">Phone</a></li>
            <li><a role="menuitem" v-on="click:addProp('email')">Email</a></li>
            <li><a role="menuitem" v-on="click:addProp('link')">Link</a></li>
          </ul>
        </div>
      </li>
    </ul>
    <button
        class="btn btn-default submit"
        v-class="hidden:!isNew, disabled:!hasChanges"
        v-on="click:createNode"
    >
      Create
    </button>
    <button
        class="btn btn-default submit"
        v-class="hidden:isNew, disabled:!hasChanges"
        v-on="click:saveNode"
    >
      Save
    </button>
  </div>
</template>

@views.html.graph.ghostlink()