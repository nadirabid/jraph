@layout("Data Visualization") {
  <div id="all">
    <main id="main">
      <div class="x-paper hidden floating-panel-bar" id="floatingPanelBar" v-cloak>
        <div class="panel-bar-menu" v-on="click:closePanel">
          <button><i class="fa fa-times"></i></button>
        </div>
        <div class="panel-bar-content" v-el="panelContent"></div>
      </div>

      <div id="zoomBar" style="position:absolute;" v-cloak>
        <div class="btn-group-vertical zoom-bar" role="group">
          <button type=button class="btn btn-default" v-on="click:incrementZoomLevel">
            <i class="fa fa-plus"></i>
          </button>
          <button type=button class="btn btn-default" v-on="click:decrementZoomLevel">
            <i class="fa fa-minus"></i>
          </button>
        </div>
      </div>

      <div class="graph-container">
        <svg id="graph" v-on="contextmenu:contextMenu, wheel:mousewheelZoom">
            <!-- Definitions -->
          <defs>
            <marker
                id="edgeArrow"
                markerWidth="5" markerHeight="3"
                refx="1.2" refy="1.5"
                orient="auto"
            >
              <path d="M0,0 L0,3 L3,1.5 L0,0" class="edge-arrow"></path>
            </marker>
            <marker
                id="connectedEdgeArrow"
                markerWidth="5" markerHeight="3"
                refx="1.2" refy="1.5"
                orient="auto"
            >
              <path d="M0,0 L0,3 L3,1.5 L0,0" class="connected-edge-arrow"></path>
            </marker>
          </defs>

          <g v-el="nodesAndLinksGroup">
            <!-- Dynamic Content -->
            <g class="dynamic-content" v-el="dynamicContent"></g>

            <!-- Edges -->
            <x-edge v-repeat="edges" track-by="id"></x-edge>

            <g v-el="newEdgeContainer"></g>

            <!-- Nodes -->
            <x-node v-repeat="nodes" track-by="id"></x-node>
          </g>
        </svg>

        <ul id="nodeContextMenu" class="dropdown-menu hidden" role="menu" style="position:absolute;">
          <li role="presentation" v-on="click:delete"><a role="menuitem" tabindex="-1">Delete Node</a></li>
          <li role="presentation" v-on="click:link"><a role="menuitem" tabindex="-1">Link Node</a></li>
        </ul>

        <ul id="edgeContextMenu" class="dropdown-menu hidden" role="menu" style="position:absolute;">
          <li role="presentation" v-on="click:delete"><a role="menuitem" tabindex="-1">Delete Link</a></li>
        </ul>

        <ul id="graphContextMenu" class="dropdown-menu hidden" role="menu" style="position:absolute;">
          <li role="presentation" v-on="click:addNode"><a role="menuitem" tabindex="-1">Add Node</a></li>
          <li role="presentation" v-on="click:saveGraph"><a role="menuitem" tabindex="-1">Save Graph</a></li>
        </ul>
      </div>
    </main>
  </div>
}

<template id="graph.node.rect">
  <g
    class="node enable-pointer-events"
    v-attr="id: id, transform: nodeTranslate"
    v-on="
        mouseenter:mouseover,
        mouseleave:mouseout,
        contextmenu:suppressContextMenu
    "
  >
    <rect
        rx="2" ry="2"
        class="background"
        v-class="hidden:!isMouseentered || dragFlag"
        v-attr="
            height:height,
            width:backgroundWidth,
            transform:backgroundTranslate
        "
    ></rect>
    <g class="pill-button-list" v-class="transition-enabled:isNodeReady">
      <g
          class="pill-button"
          v-style="transform:deleteNodePillButtonTranslate"
          v-on="click:delete"
      >
        <rect rx="2" ry="2" v-attr="width:pillButtonWidth, height:height"></rect>
        <text
            text-anchor="middle"
            v-attr="transform:deleteNodePillButtonTextTranslate"
            v-el="deleteNodeText"
        >
          &#xf014
        </text>
      </g>
      <g
          class="pill-button"
          v-style="transform:linkNodePillButtonTranslate"
          v-on="click:setNewEdgeSource"
      >
        <rect rx="2" ry="2" v-attr="width:pillButtonWidth, height:height"></rect>
        <text
            text-anchor="middle"
            v-attr="transform:linkNodePillButtonTextTranslate"
        >
          &#xf0c1
        </text>
      </g>
    </g>
    <g v-attr="transform:rectTranslate">
      <rect
          class="node-rect-background-highlight"
          rx="2" ry="2"
          v-el="nodeRectBackgroundHighlight"
          v-attr="width:width, height:height"
      ></rect>
      <rect
          class="node-rect-background"
          rx="2" ry="2"
          v-el="nodeRectBackground"
          v-attr="width:width, height:height"
      ></rect>
      <rect
          class="node-rect"
          rx="2" ry="2"
          v-el="nodeRect"
          v-attr="width:width, height:height"
      ></rect>
    </g>
    <text
        class="node-name disable-pointer-events"
        text-anchor="middle"
        v-el="nodeName"
    >
      {{data.name}}
    </text>
  </g>
</template>

<template id="graph.edge">
  <g class="enable-pointer-events" v-on="contextmenu:edgeContextMenu">
    <line
        class="edge"
        marker-end="url(#edgeArrow)"
        v-el="arrowMarkerLine"
        v-attr="x1:sourceClipX, y1:sourceClipY, x2:targetClipX, y2:targetClipY"
    ></line>
  </g>
</template>

<template id="graph.newEdge">
  <line
      class="edge new-edge"
      v-class="connected:connected"
      v-attr="
          marker-end:edgeArrow,
          x1:sourceClipX,
          y1:sourceClipY,
          x2:targetClipX, y2:targetClipY
      "
  >
  </line>
</template>

<template id="node.panel">
  <div class="node-panel">
    <button type="button" class="close" aria-label="Close" v-on="click:closeNodePanel">
      <span aria-hidden="true">&times;</span>
    </button>
    <h3 v-on="click:editName" v-class="hidden:editingName">{{node.data.name}}</h3>
    <input
        type="text"
        class="form-control input-lg"
        v-model="node.data.name"
        v-class="hidden:!editingName"
        v-el="nameInput"
        v-on="
            blur   : updateName,
            keyup  : updateName       | key enter,
            keyup  : cancelNameUpdate | key esc
        "
    >
    <ul class="list-unstyled">
      <li v-repeat="propsGroup: propertyGroups">
        <dl class="node-property-list">
          <dt>{{$key}}</dt>
          <dd v-repeat="prop: propsGroup">
            <div
                v-class="hidden:prop.edit_"
            >
                {{prop.value}}
              <button
                  aria-label="Close"
                  class="close"
                  type="button"
                  v-on="click: removeProp(this)"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <input
                type="text"
                class="form-control"
                v-class="hidden:!prop.edit_"
                v-on="
                    blur   : updateProp(this),
                    keyup  : updateProp(this)        | key enter,
                    keyup  : cancelPropUpdate(this)  | key esc
                "
            >
          </dd>
        </dl>
      </li>
      <li class="input-group" v-el="propertyInputGroup">
        <input
            class="form-control"
            placeholder="Value"
            type="text"
            v-el="propertyValue"
            v-on="keydown:validateInputChange, paste:validateInputChange"
        >
        <div class="input-group-btn" role="group">
          <button
              type="button"
              class="btn btn-default dropdown-toggle disabled"
              data-toggle="dropdown"
              v-el="addDropdownBtn"
          >
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
          </button>
          <ul class="dropdown-menu dropdown-menu-right" role="menu">
            <li role="presentation" class="dropdown-header">Add as</li>
            <li><a role="menuitem" v-on="click:addProp('text')">Text</a></li>
            <li><a role="menuitem" v-on="click:addProp('phone')">Phone</a></li>
            <li><a role="menuitem" v-on="click:addProp('email')">Email</a></li>
            <li><a role="menuitem" v-on="click:addProp('link')">Link</a></li>
          </ul>
        </div>
      </li>
    </ul>
    <button
        class="btn btn-default submit"
        v-class="hidden:!isNew, disabled:!hasChanges"
        v-on="click:createNode"
    >
      Create
    </button>
    <button
        class="btn btn-default submit"
        v-class="hidden:isNew, disabled:!hasChanges"
        v-on="click:saveNode"
    >
      Save
    </button>
  </div>
</template>

<template id="node.panel2">
  <div class="node-panel">
    <div class="title">
      <h3 v-on="click:editName" v-class="hidden:editingName">{{node.data.name}}</h3>
      <input
          class="x-input"
          type="text"
          v-class="hidden:!editingName"
          v-model="node.data.name"
          v-el="nameInput"
          v-on="
              blur   : updateName,
              keyup  : updateName       | key enter,
              keyup  : cancelNameUpdate | key esc
          "
      >
    </div>

    <section class="info tags">
      <div class="info-title">
        <span class="line-around"><i class="fa fa-tags"></i></span>
      </div>
      <div class="info-body">
        <input
            class="x-input"
            type="text"
            placeholder="Add tag"
            v-model="tagInputValue"
            v-on="keyup:addTag | key enter"
        >
        <ul class="tag-list">
          <li v-repeat="tag: node.data.properties.tags">
            <i class="fa fa-times"></i> {{tag.value}}
          </li>
        </ul>
      </div>
    </section>

    <section class="info">
      <div class="info-title">
        <span class="line-around"><i class="fa fa-link"></i></span>
      </div>
      <div class="info-body">
        <input
            class="x-input"
            type="text"
            placeholder="Add link"
            v-model="linkInputValue"
            v-on="keyup:addLink | key enter"
        >
        <ul class="email-list">
          <li v-repeat="link: node.data.properties.links">{{link.value}}</li>
        </ul>
      </div>
    </section>

    <section class="info">
      <div class="info-title">
        <span class="line-around"><i class="fa fa-envelope-o"></i></span>
      </div>
      <div class="info-body">
        <input
            class="x-input"
            type="text"
            placeholder="Add email"
            v-model="emailInputValue"
            v-on="keyup:addEmail | key enter"
        >
        <ul class="email-list">
          <li v-repeat="email: node.data.properties.emails">{{email.value}}</li>
        </ul>
      </div>
    </section>

    <section class="info">
      <div class="info-title">
        <span class="line-around"><i class="fa fa-phone"></i></span>
      </div>
      <div class="info-body">
        <input
            class="x-input"
            type="text"
            placeholder="Add phone number"
            v-model="phoneNumberInputValue"
            v-on="keyup:addPhoneNumber | key enter"
        >
        <ul class="email-list">
          <li v-repeat="phoneNumber: node.data.properties.phoneNumbers">{{phoneNumber.value}}</li>
        </ul>
      </div>
    </section>
  </div>
  <div class="node-panel-menu">
    <div
        class="button"
        v-class="hidden:isNew || !hasChanges, disabled:saving"
        v-on="click:saveNode"
    >
      Save
    </div>
    <div
        class="button"
        v-class="hidden:!isNew, disabled:saving"
        v-on="click:createNode"
    >
      Create
    </div>
  </div>
</template>