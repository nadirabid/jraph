<div class="graph-container">
  <svg class="disable-user-selection" id="graph" v-attr="viewBox:viewBox" v-on="contextmenu:contextMenu">
    <!-- Definitions -->
    <defs>
      <marker id="def-marker-arrow"
              markerWidth="2"
              markerHeight="2"
              refx="8"
              refy="1"
              orient="auto">
        <path d="M0,0 L0,2 L2,1 L0,0" class="marker-arrow"></path>
      </marker>
      <marker id="def-marker-ghost-arrow"
              markerWidth="2"
              markerHeight="2"
              refx="2"
              refy="1"
              orient="auto">
        <path d="M0,0 L0,2 L2,1 L0,0" class="marker-arrow"></path>
      </marker>
    </defs>

    <!-- Dynamic Content -->
    <g class="dynamic-content" v-el="dynamicContent"></g>

    <!-- Links -->
    <x-link v-repeat="links" track-by="id"></x-link>

    <!-- Nodes -->
    <x-node v-repeat="nodes" track-by="id"></x-node>
  </svg>

  <ul id="contextMenu" class="dropdown-menu hidden" role="menu" style="position:absolute;">
    <li role="presentation" v-on="click:addNode"><a role="menuitem" tabindex="-1">Add Node</a></li>
  </ul>

  <template id="graph.link">
    <g class="enable-pointer-events">
      <line class="link"
            v-attr="x1:source.x, y1:source.y, x2:target.x, y2:target.y"></line>
      <line class="marker-arrow"
            marker-end="url(#def-marker-arrow)"
            v-attr="x1:source.x, y1:source.y, x2:target.x, y2:target.y"></line>
    </g>
  </template>

  <template id="graph.node">
    <g class="node enable-pointer-events" v-attr="id: id, transform: nodeTranslate">
      <circle class="node-circle" v-attr="r:radius + 'em'" v-el="nodeCircle"></circle>
      <text class="node-label" text-anchor="middle" v-attr="transform: labelTranslate" v-el="nodeLabel">
        {{label}} {{$index}}
      </text>
    </g>
  </template>
</div>

<div class="sidebar-container">
  <div id="sidebar" class="sidebar-menu"></div>

  <template id="node.panel">
    <h3 v-on="dblclick:editLabel()"
        v-class="hidden:editingLabel">
      {{node.label}}
    </h3>
    <input type="text"
           class="form-control"
           v-model="node.label"
           v-class="hidden:!editingLabel"
           v-el="labelInput"
           v-on="blur   : updateLabel,
                 keyup  : updateLabel()       | key enter,
                 keyup  : cancelLabelUpdate(this) | key esc">
    <ul class="list-unstyled">
      <li class="input-group">
        <input type="text" class="form-control" placeholder="Value">
        <div class="input-group-btn" role="group">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
          </button>
          <ul class="dropdown-menu dropdown-menu-right" role="menu">
            <li role="presentation" class="dropdown-header">Add as</li>
            <li><a role="menuitem" v-on="click:addText">Text</a></li>
            <li><a role="menuitem" v-on="click:addPhone">Phone</a></li>
            <li><a role="menuitem" v-on="click:addEmail">Email</a></li>
            <li><a role="menuitem" v-on="click:addLink">Link</a></li>
          </ul>
        </div>
      </li>
    </ul>
  </template>
</div>

@views.html.graph.ghostlink()